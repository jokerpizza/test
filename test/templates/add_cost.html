{% extends "base.html" %}
{% block content %}
<div class="container">
  <h2>Dodaj Koszt</h2>
  <form method="POST" action="{{ url_for('add_cost') }}">
    <div class="mb-3">
      <label class="form-label">Data:</label>
      <input type="date" name="date" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Kategoria główna:</label>
      <select id="main_cat" name="main_category" class="form-select" required onchange="updateSubcats()">
        <option value="">— wybierz —</option>
        {% for mc in main_categories %}
        <option value="{{ mc.id }}">{{ mc.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Podkategoria:</label>
      <select id="sub_cat" name="subcategory" class="form-select" required>
        <option value="">— wybierz —</option>
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Opis:</label>
      <textarea name="description" class="form-control" required></textarea>
    </div>
    <div class="mb-3">
      <label class="form-label">Kwota:</label>
      <input type="number" name="amount" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Sposób płatności:</label>
      <select name="payment_method" class="form-select" required>
        <option value="Gotówka">Gotówka</option>
        <option value="Przelew">Przelew</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary">Dodaj</button>
  </form>
</div>

<script>
const subsMap = {
{% for mc in main_categories %}
  {{ mc.id }}: [
    {% for sc in mc.subcategories %}
    { id: {{ sc.id }}, name: "{{ sc.name }}" }{% if not loop.last %}, {% endif %}
    {% endfor %}
  ]{% if not loop.last %},{% endif %}
{% endfor %}
};

function updateSubcats() {
  const mainId = document.getElementById('main_cat').value;
  const subSelect = document.getElementById('sub_cat');
  subSelect.innerHTML = '<option value="">— wybierz —</option>';
  if (!subsMap[mainId]) return;
  subsMap[mainId].forEach(s => {
    const opt = document.createElement('option');
    opt.value = s.id;
    opt.text = s.name;
    subSelect.appendChild(opt);
  });
}
</script>
{% endblock %}
