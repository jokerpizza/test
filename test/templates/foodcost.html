{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Food Cost</h2>
  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3">
    <li class="nav-item">
      <a class="nav-link {% if tab=='products' %}active{% endif %}" href="{{ url_for('foodcost', tab='products') }}">Produkty</a>
    </li>
    <li class="nav-item">
      <a class="nav-link {% if tab=='dishes' %}active{% endif %}" href="{{ url_for('foodcost', tab='dishes') }}">Dania</a>
    </li>
    <li class="nav-item">
      <a class="nav-link {% if tab=='analysis' %}active{% endif %}" href="{{ url_for('foodcost', tab='analysis') }}">Analiza</a>
    </li>
  </ul>

  {% if tab=='products' %}
  <div class="card p-3 mb-4">
    <h4>Dodaj produkt</h4>
    <form method="POST" action="{{ url_for('add_product') }}">
      <div class="mb-2">
        <input name="name" class="form-control" placeholder="Nazwa produktu" required>
      </div>
      <div class="mb-2">
        <input name="price_per_kg" type="number" step="0.01" class="form-control" placeholder="Cena za kg" required>
      </div>
      <button class="btn btn-success">Dodaj</button>
    </form>
  </div>
  <div class="card p-3">
    <h4>Produkty</h4>
    <table class="table table-striped">
      <thead><tr><th>Nazwa</th><th>Cena za kg</th></tr></thead>
      <tbody>
        {% for p in products %}
        <tr><td>{{ p.name }}</td><td>{{ p.price_per_kg }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% elif tab=='dishes' %}
  <div class="card p-3 mb-4">
    <h4>Dodaj danie</h4>
    <form method="POST" action="{{ url_for('add_dish') }}">
      <div class="mb-2">
        <input name="name" class="form-control" placeholder="Nazwa dania" required>
      </div>
      <div class="mb-2">
        <input name="sale_price" type="number" step="0.01" class="form-control" placeholder="Cena sprzedaży" required>
      </div>
      <h5>Receptura</h5>
      <div id="recipe-items">
        <!-- dynamic recipe items injected via JS -->
      </div>
      <button type="button" id="add-item" class="btn btn-link">+ Dodaj składnik</button>
      <br><button class="btn btn-success mt-2">Dodaj danie</button>
    </form>
  </div>
  <div class="card p-3">
    <h4>Dania</h4>
    <table class="table table-striped">
      <thead><tr><th>Nazwa</th><th>Cena</th></tr></thead>
      <tbody>
        {% for d in dishes %}
        <tr><td>{{ d.name }}</td><td>{{ d.sale_price }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="row">
    {% for a in analysis %}
    <div class="col-md-4 mb-3">
      <div class="card p-3 text-center">
        <h5>{{ a.dish }}</h5>
        <h2>{{ '%.2f' % a.pct }}%</h2>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/foodcost.js') }}"></script>
{% endblock %}
