{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <h2 class="mb-4 text-2xl font-bold">Podsumowanie</h2>

  <!-- Filtry -->
  <form method="GET" action="{{ url_for('cost_summary') }}" class="flex flex-wrap gap-4 mb-6">
    <select name="month" class="form-select w-auto">
      {% for m in range(1, 13) %}
        <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>{{ m }}</option>
      {% endfor %}
    </select>
    <select name="year" class="form-select w-auto">
      {% for y in range(2022, 2031) %}
        <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>
    <button class="btn btn-primary">Zastosuj</button>
  </form>

  <!-- Karty kategorii -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    {% for category, subcats in summary.items() %}
      <div class="card p-4 rounded-2xl shadow">
        <h3 class="text-lg font-bold mb-2">{{ category }}</h3>
        <p class="text-xl text-red-600 font-semibold">
          {{ subcats.values() | sum | round(2) }} zł
        </p>
      </div>
    {% endfor %}
  </div>

  <!-- Szczegóły kategorii i podkategorii -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      {% for category, subcats in summary.items() %}
        <div class="mb-6">
          <h4 class="text-xl font-semibold mb-2">{{ category }}</h4>
          <ul class="pl-4">
            {% for subcat, total in subcats.items() %}
              <li class="flex justify-between py-1 border-b">
                <span>{{ subcat }}</span>
                <span>{{ total | round(2) }} zł</span>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    </div>

    <!-- Wykres (Canvas placeholder) -->
    <div>
      <canvas id="categoryPieChart" width="400" height="400"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('categoryPieChart').getContext('2d');
  const pieChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: {{ summary.keys() | list | safe }},
      datasets: [{
        data: {{ summary.values() | map('values') | map('sum') | list | safe }},
        backgroundColor: ['#F87171','#FBBF24','#34D399','#60A5FA','#A78BFA','#F472B6']
      }]
    }
  });
</script>
{% endblock %}
