{% extends "base.html" %}
{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}
{% block content %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Koszty</h2>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#costModal">+ Dodaj koszt</button>
  </div>

  <div class="row mb-3">
    <div class="col-md-3">
      <select id="filterCategory" class="form-select">
        <option value="">Wszystkie kategorie</option>
      </select>
    </div>
    <div class="col-md-3">
      <select id="filterPayment" class="form-select">
        <option value="">Wszystkie płatności</option>
        <option value="Gotówka">Gotówka</option>
        <option value="Przelew">Przelew</option>
      </select>
    </div>
    <div class="col-md-3">
      <input type="month" id="filterMonth" class="form-control">
    </div>
    <div class="col-md-3 d-flex gap-2">
      <button class="btn btn-outline-secondary" id="exportCsv">📥 Eksport CSV</button>
    </div>
  </div>

  <div id="summaryBar" class="alert alert-info">Podsumowanie: <span id="totalAmount">0</span> zł</div>

  <div class="row" id="costCardsContainer"></div>

  <hr class="my-4" />
  <h4>Statystyki</h4>
  <canvas id="costChart" height="100"></canvas>
</div>

<!-- Modal dodawania/edycji kosztu -->
<div class="modal fade" id="costModal" tabindex="-1" aria-labelledby="costModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="costForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="costModalLabel">Dodaj koszt</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="costId" name="id">
        <div class="mb-3">
          <label class="form-label">Data</label>
          <input type="date" name="date" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Kategoria</label>
          <input type="text" name="category" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Opis</label>
          <textarea name="description" class="form-control" required></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Kwota</label>
          <input type="number" name="amount" class="form-control" step="0.01" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Sposób płatności</label>
          <select name="payment_method" class="form-select">
            <option value="Gotówka">Gotówka</option>
            <option value="Przelew">Przelew</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success">Zapisz</button>
      </div>
    </form>
  </div>
</div>

<script src="{{ url_for('static', filename='costs.js') }}"></script>
{% endblock %}
